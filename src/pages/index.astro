---
import { getCollection } from 'astro:content';
import BaseLayout from '../layouts/BaseLayout.astro';
import Header from '../components/Header.astro';
import FilterBar from '../components/FilterBar.astro';
import PlanchaCard from '../components/PlanchaCard.astro';
import Footer from '../components/Footer.astro';

const planchas = await getCollection('planchas');
const sorted = planchas.sort((a, b) => a.data.orden - b.data.orden);
const grados = [...new Set(planchas.map(p => p.data.grado))].sort();

const websiteSchema = {
    "@context": "https://schema.org",
    "@type": "WebSite",
    "name": "El Damero",
    "description": "Del Aprendiz al Maestro: estudio operativo de los tres grados simbólicos de la masonería",
    "url": "https://eldamero.com",
    "inLanguage": "es-AR",
    "potentialAction": {
        "@type": "SearchAction",
        "target": {
            "@type": "EntryPoint",
            "urlTemplate": "https://eldamero.com/?q={search_term_string}"
        },
        "query-input": "required name=search_term_string"
    }
};
---

<BaseLayout title="El Damero | Planchas Masónicas">
    <Header />

    <script type="application/ld+json" set:html={JSON.stringify(websiteSchema)} />

    {sorted.length > 0 && <FilterBar grados={grados} />}

    <div class="planchas-grid">
        {sorted.length > 0 ? (
            sorted.map(plancha => (
                    <PlanchaCard
                            title={plancha.data.title}
                            slug={plancha.slug}
                            grado={plancha.data.grado}
                            date={plancha.data.date}
                            tema={plancha.data.tema}
                            autor={plancha.data.autor}
                            orden={plancha.data.orden}
                    />
            ))
        ) : (
                <div class="empty">
                    <p>Sin planchas aún. Comenzá a agregar tus trazados.</p>
                </div>
        )}
    </div>

    <Footer />
</BaseLayout>

<style>
    .planchas-grid {
        display: grid;
        gap: var(--spacing-md);
        margin-bottom: var(--spacing-xl);
    }

    .empty {
        text-align: center;
        padding: var(--spacing-xl);
        color: var(--damero-gray);
        border: 1px dashed var(--damero-gray);
        background: var(--damero-dark);
    }
</style>